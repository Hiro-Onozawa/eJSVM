OPT_DEBUG     = false
include BASEBIT.txt
# OPT_BASEBIT   = 64
# OPT_GC_ALGORITHM = threaded_compact

EJSVM_DIR = ../ejsvm

.PRECIOUS: %.c %.h %.o

##
## configuration files
##

# DATATYPES = $(EJSVM_DIR)/datatypes/default.def
OPERANDSPEC = $(EJSVM_DIR)/operand-spec/any.spec
# OPERANDSPEC = $(EJSVM_DIR)/operand-spec/fixnum-unspec.spec
# SUPERINSNSPEC = $(EJSVM_DIR)/superinsn-spec/all.si
# SUPERINSNTYPE = 4

##
## compile flags
##

CFLAGS = -O2 -Wall -Wextra $(HEAPSIZE)
# CFLAGS = -O2 -UNDEBUG -DDEBUG -DPROFILE -DGC_CLEAR_MEM=0 -Wall -Wextra $(HEAPSIZE)
# CFLAGS = -Os -DNDEBUG -UDEBUG $(HEAPSIZE)
# CFLAGS = -O0 -g $(HEAPSIZE)
INSNGEN_FLAGS = -Xgen:pad_cases true -Xcmp:opt_pass MR:S -Xcmp:rand_seed 0

##
## commands
##

CC = gcc
# SED = gsed
SED = sed
RUBY = ruby
# PYTHON = python
PYTHON = python3
# COCCINELLE = spatch
COCCINELLE = spatch --python python3

##
## paths
##

INCLUDES =
# INCLUDES = -I/opt/local/include
LIBS =
# LIBS = -L/opt/local/lib

## 
## options
## 

# OPT_DEBUG     = false
# OPT_BASEBIT   = 32
OPT_REGEXP    = none
# OPT_REGEXP    = oniguruma
OPT_GC        = native
# OPT_GC        = boehmgc
# OPT_GC        = none
# OPT_GC_ALGORITHM = mark_sweep
include ./ALGORITHM.txt
# HEAPSIZE      = -DJS_SPACE_BYTES=10486760
include ./HEAPSIZE.txt
include ./CFLAGS.txt
# HEAPSIZE      = -DJS_SPACE_BYTES=10485760
# HEAPSIZE      = -DJS_SPACE_BYTES=20971520
# HEAPSIZE      = -DJS_SPACE_BYTES=6242880
CFLAGS       += -DGC_TIMEOUT_SEC=10
CFLAGS       += -DGC_TIMEOUT_USEC=0
USE_VMDL      = true

CFLAGS       += -DUSE_SBC
CFLAGS       += -DUSE_OBC

# CFLAGS       += -DPROFILE

ifeq ($(OPT_BASEBIT), 32)
 DATATYPES = $(EJSVM_DIR)/datatypes/default_32.def
endif
ifeq ($(OPT_BASEBIT), 64)
  DATATYPES = $(EJSVM_DIR)/datatypes/default.def
endif
include $(EJSVM_DIR)/common.mk
